<?php
/**
 * Part of the Joomla Framework CVE Package
 *
 * @copyright  Copyright (C) 2021 Open Source Matters, Inc. All rights reserved.
 * @license    GNU General Public License version 2 or later; see LICENSE
 */

namespace Joomla\Cve\Tests;

use Joomla\Cve\CveFilter;
use Joomla\Cve\CveId;
use PHPUnit\Framework\TestCase;

class CveFilterTest extends TestCase
{
	/**
	 * Provide examples of valid filter values
	 *
	 * @return array[]
	 * @throws \Exception
	 */
	public function validFilterValues(): array
	{
		$timezone = new \DateTimeZone('UTC');

		return [
			[CveId::RESERVED, 1999, null, null, 'state=RESERVED&year=1999'],
			[
				CveId::PUBLIC,
				null,
				new \DateTime('2020-11-13', $timezone),
				new \DateTime('2020-12-31', $timezone),
				'state=PUBLIC&time_reserved.gt=2020-11-13T00%3A00%3A00.000%2B00%3A00&time_reserved.lt=2020-12-31T00%3A00%3A00.000%2B00%3A00',
			],
		];
	}

	/**
	 * @param $state
	 * @param $year
	 * @param $after
	 * @param $before
	 * @param $expected
	 *
	 * @dataProvider validFilterValues
	 */
	public function testFilter($state, $year, $after, $before, $expected): void
	{
		$filter = new CveFilter();
		$filter->state($state)->year($year)->reservedAfter($after)->reservedBefore($before);

		self::assertEquals($expected, (string) $filter);
	}
}
