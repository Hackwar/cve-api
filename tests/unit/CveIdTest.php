<?php
/**
 * Part of the Joomla Framework CVE Package
 *
 * @copyright  Copyright (C) 2021 Open Source Matters, Inc. All rights reserved.
 * @license    GNU General Public License version 2 or later; see LICENSE
 */

namespace Joomla\Cve\Tests;

use Joomla\Cve\CveId;
use PHPUnit\Framework\TestCase;

class CveIdTest extends TestCase
{
	/**
	 * @testdox CveId provides access to id meta data
	 */
	public function testValidId(): void
	{
		$idFromResponse = json_decode('{
				"requested_by": {
					"cna": "education",
					"user": "angelaclark@education.com"
				},
				"cve_id": "CVE-2021-0023",
				"cve_year": "2021",
				"state": "RESERVED",
				"owning_cna": "education",
				"reserved": "2020-11-13T19:37:34.854Z"
			}',
			true);

		$id = new CveId($idFromResponse);

		self::assertEquals('CVE-2021-0023', (string) $id, 'String representation should be the CVE ID itself');
		self::assertEquals('education', $id->requestingCna());
		self::assertEquals('angelaclark@education.com', $id->requestingUser());
		self::assertEquals('CVE-2021-0023', $id->cveId());
		self::assertEquals(2021, $id->cveYear());
		self::assertEquals(CveId::RESERVED, $id->state());
		self::assertEquals('education', $id->owningCna());
		self::assertEquals('2020-11-13 19:37:34', $id->reservedAt()->format('Y-m-d H:i:s'));
	}

	/**
	 * @testdox CveID throws an UnexpectedValueException on invalid id
	 */
	public function testInvalidId(): void
	{
		#$this->expectException(\UnexpectedValueException::class);

		/** @noinspection PhpUnusedLocalVariableInspection */
		$id = new CveId(['foo' => 'bar']);
	}
}
